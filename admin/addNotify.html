<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>发布公告</title>
		<!-- Bootstrap core CSS-->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom fonts for this template-->
		<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<!-- Page level plugin CSS-->
		<link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
		<!-- Custom styles for this template-->
		<link href="css/sb-admin.css" rel="stylesheet">
		<script src="vendor/jquery/jquery.min.js"></script>
		<script src="js/jsxm.js"></script>
		<style>
			.node circle {
				cursor: pointer;
				stroke: #91decb;
				stroke-width: 1.5px;
			}
			
			.node text {
				font: 14px sans-serif;
				pointer-events: none;
				text-anchor: middle;
			}
			
			line.link {
				fill: none;
				stroke: #9ecae1;
				stroke-width: 1.5px;
			}
		</style>
	</head>

	<body class="fixed-nav sticky-footer bg-dark" id="page-top">
		<!-- Navigation-->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
			<a class="navbar-brand" href="index.html">金审平台后台管理</a>
			<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav navbar-sidenav" id="exampleAccordion">

					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="userManagement.html">
							<i class="fa fa-fw fa-user"></i>
							<span class="nav-link-text">用户管理</span>
						</a>

					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="log.html">
							<i class="fa fa-fw fa-trello"></i>
							<span class="nav-link-text">日志展示</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="baseData.html">
							<i class="fa fa-fw fa-database"></i>
							<span class="nav-link-text">基础数据维护</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="permission.html">
							<i class="fa fa-fw fa-lock"></i>
							<span class="nav-link-text">权限管理</span>
						</a>
					</li>
					
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="addNotify.html">
							<i class="fa fa-fw fa-comments"></i>
							<span class="nav-link-text"> 发布公告</span>
						</a>
					</li>

				</ul>
				<ul class="navbar-nav sidenav-toggler">
					<li class="nav-item">
						<a class="nav-link text-center" id="sidenavToggler">
							<i class="fa fa-fw fa-angle-left"></i>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav ml-auto">

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-bell"></i> 通知

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" style="width: 250px;" aria-labelledby="alertsDropdown" id="notice">
							<h6 class="dropdown-header">最近通知:</h6>

						</div>
					</li>

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-user"></i><label id="usernameLable">用户名</label>

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">

							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="window.open('userInfo.html')">
								<i class="fa fa-fw fa-cogs"></i>个人信息
							</a>

							<div class="dropdown-divider"></div>
							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="logout()">
								<i class="fa fa-fw fa-sign-out"></i>退出登录
							</a>

						</div>
					</li>

				</ul>
			</div>
		</nav>
		<style>
			/*设置第八列，也就是按钮居中*/
			
			.table th,
			.table td:nth-child(8) {
				text-align: center;
				vertical-align: middle!important;
			}
		</style>
		<div class="content-wrapper">
			<div class="container-fluid">
				<!-- Breadcrumbs-->
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="#">后台管理</a>
					</li>
					<li class="breadcrumb-item active">公告</li>
				</ol>
				<!-- Example DataTables Card-->

				<div class="card mb-3" style="width: 700px;">
					<div class="card-header">
						<i class="fa fa-filter"></i>
						<a class="card-link" style='color:black'>发布公告</a>

					</div>
					<div class="card-body">
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text">通知标题</span>
							</div>
							<input type="text" class="form-control" id="title">
						</div>
						<div class="input-group mb-3">
							<div class="input-group-prepend">
								<span class="input-group-text">通知内容</span>
							</div>
							<textarea class="form-control" rows="5" id="message"></textarea>

						</div>

						<button class="btn btn-primary" onclick="addNotification()">发布</button>&nbsp;&nbsp;<span id="addNoMsg" style="color: red;"></span>
					</div>

				</div>

			</div>
			<!-- /.container-fluid-->
			<!-- /.content-wrapper-->
			<footer class="sticky-footer">
				<div class="container">
					<div class="text-center">
						<small>Copyright © Your Website 2018</small>
					</div>
				</div>
			</footer>

			<!-- Bootstrap core JavaScript-->
			<script src="vendor/jquery/jquery.min.js"></script>
			<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
			<!-- Core plugin JavaScript-->
			<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
			<!-- Page level plugin JavaScript-->
			<!--<script src="vendor/chart.js/Chart.min.js"></script>-->
			<script src="vendor/datatables/jquery.dataTables.js"></script>
			<script src="vendor/datatables/dataTables.bootstrap4.js"></script>
			<!-- Custom scripts for all pages-->
			<script src="js/sb-admin.min.js"></script>
			<!-- Custom scripts for this page-->
			<script src="js/sb-admin-datatables.min.js"></script>
			<!--<script src="js/sb-admin-charts.min.js"></script>-->
			<script src="js/jsxm.js"></script>
			<script>
				function logout() {

					$.ajax({
						type: "post",
						url: logoutUrl,
						cache: false, //禁用缓存
						data: "", //传入组装的参数
						dataType: "json",
						async: false,
						beforeSend: function(xhr) {
							xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
						},
						success: function(result) {
							//								alert("登录状态错误，请重新登录");
							//							
							window.open('login.html');
						},
						error: function(result, status) {
							console.log(result)
							window.location.href = 'login.html';
						}
					});
				}

				function getNotice() {
					$.ajax({
						type: "post",
						url: getNoticeUrl,
						cache: false, //禁用缓存
						contentType: "application/json,charset=utf-8",
						data: null, //传入组装的参数
						dataType: "json",
						async: false,
						crossDomain: true,
						scriptCharset: 'utf-8',
						beforeSend: function(xhr) {
							xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
						},
						success: function(result) {
							var NotiData = "";
							for(i in result) {
								console.log(i);
								NotiData += '<div class="dropdown-divider"></div>' +
									'<a class="dropdown-item">' +
									'<span class="text-success">' +
									'<strong>' + result[i]["NoTitle"] + '</strong></span>' +
									'<span class="small float-right text-muted" >' + result[i]["NoTime"] + '</span>' +
									'</br><div class="dropdown-message small" >' + result[i]["NoContent"] + '</div></a>';

							}
							console.log(NotiData);
							$('#notice').append(NotiData);

						},
						error: function(result, status) {
							console.log(result)
						},
						statusCode: {
							401: function() {
								alert("登录状态错误，请重新登录后再尝试");
								window.open('login.html?type=1');
							},
							405: function() {
								alert("您无权进行此操作");
							}
						}
					});
				}

				function addNotification() {
					if($('#title').val() == null || $('#title').val() == "") {
						$('#addNoMsg').text("请填写信息");
							return;
						}
						else {
							var param = {};
							param["title"] = $('#title').val();
							param["message"] = $('#message').val();

							$.ajax({
								type: "post",
								url: addNotificationUrl,
								cache: false, //禁用缓存
								data: param, //传入组装的参数

								async: false,
								beforeSend: function(xhr) {
									xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
								},
								success: function(result) {
									$('#addNoMsg').text("添加成功")

								},
								error: function(result, status) {
									//							$('#addNoMsg').text("添加成功")
									//							$('addNoMsg').text("添加成功")
								}
							});
							//					alert("添加成功")
									$('#addNoMsg').text("添加成功")
							
						}
					}
			</script>
			<script>
				$('#usernameLable').text(localStorage.getItem("username"));
			</script>
			<script>
				$(document).ready(function() {
					getNotice();
				})
			</script>

		</div>
	</body>

</html>