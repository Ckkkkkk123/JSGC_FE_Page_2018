<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>用户管理</title>
		<!-- Bootstrap core CSS-->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom fonts for this template-->
		<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<!-- Page level plugin CSS-->
		<link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
		<!-- Custom styles for this template-->
		<link href="css/sb-admin.css" rel="stylesheet">
		<script src="vendor/jquery/jquery.min.js"></script>
		<script src="js/jsxm.js"></script>
	</head>

	<body class="fixed-nav sticky-footer bg-dark" id="page-top">
		<!-- Navigation-->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
			<a class="navbar-brand" href="index.html">金审平台后台管理</a>
			<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav navbar-sidenav" id="exampleAccordion">

					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="userManagement.html">
							<i class="fa fa-fw fa-user"></i>
							<span class="nav-link-text">用户管理</span>
						</a>

					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="log.html">
							<i class="fa fa-fw fa-trello"></i>
							<span class="nav-link-text">日志展示</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="baseData.html">
							<i class="fa fa-fw fa-database"></i>
							<span class="nav-link-text">基础数据维护</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="permission.html">
							<i class="fa fa-fw fa-lock"></i>
							<span class="nav-link-text">权限管理</span>
						</a>
					</li>
					
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="addNotify.html">
							<i class="fa fa-fw fa-comments"></i>
							<span class="nav-link-text"> 发布公告</span>
						</a>
					</li>

				</ul>
				<ul class="navbar-nav sidenav-toggler">
					<li class="nav-item">
						<a class="nav-link text-center" id="sidenavToggler">
							<i class="fa fa-fw fa-angle-left"></i>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav ml-auto">

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-bell"></i> 通知

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" style="width: 250px;" aria-labelledby="alertsDropdown" id="notice">
							<h6 class="dropdown-header">最近通知:</h6>
							<!--<div class="dropdown-divider"></div>
							<a class="dropdown-item">
								<span class="text-success" id="noticeTitle">
                					<strong>通知1</strong>
              					</span>
								<span class="small float-right text-muted" id="noticeTime">11:21 AM</span>
								<div class="dropdown-message small" id="noticeContent">通知内容 通知内容 通知内容 通知内容</div>
							</a>
							<div class="dropdown-divider"></div>
							<a class="dropdown-item" href="#" data-toggle="modal" on data-target="#addProject">
								<span class="text-danger" id="noticeTitle2">
                <strong>
                  通知2</strong>
              </span>
								<span class="small float-right text-muted" id="noticeTime2">11:21 AM</span>
								<div class="dropdown-message small" id="noticeContent2">This is an automated server response message. All systems are online.</div>
							</a>
							<div class="dropdown-divider"></div>

							<a class="dropdown-item small" href="#">查看全部</a>-->
						</div>
					</li>

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-user"></i><label id="usernameLable">用户名</label>

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">

							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="window.open('userInfo.html')">
								<i class="fa fa-fw fa-cogs"></i>个人信息
							</a>

							<div class="dropdown-divider"></div>
							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="logout()">
								<i class="fa fa-fw fa-sign-out"></i>退出登录
							</a>

						</div>
					</li>

				</ul>
			</div>
		</nav>
		<style>
			/*设置第八列，也就是按钮居中*/
			
			.table th,
			.table td:nth-child(8) {
				text-align: center;
				vertical-align: middle!important;
			}
		</style>
		<div class="content-wrapper">
			<div class="container-fluid">
				<!-- Breadcrumbs-->
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="#">后台管理</a>
					</li>
					<li class="breadcrumb-item active">日志管理</li>
				</ol>
				<!-- Example DataTables Card-->
				
				<div class="row">
					<div class="col-md-7">
						<div class="card mb-1">
							<div class="card-header">
								<i class="fa fa-male"></i>
								<a class="card-link" style='color:black'>活跃用户</a>
								

							</div>
							<div class="card-body " style="height: 400px;">
								<div id="container2" style="height: 100%"></div>
								<script src="js/echart/china.js"></script>
								<script src="js/echart/dataTool.min.js"></script>
								<script src="js/echart/echarts.min.js"></script>
								<script src="js/echart/echarts-gl.min.js"></script>
								<script src="js/echart/ecStat.min.js "></script>
								<script type="text/javascript">
									$(document).ready(function() {
										$.ajax({
											type: "post",
											url: getDayDataListUrl,
											cache: false, //禁用缓存
											contentType: "application/json,charset=utf-8",
											data: null, //传入组装的参数
											dataType: "json",
											//										async: false,
											crossDomain: true,
											scriptCharset: 'utf-8',
											beforeSend: function(xhr) {
												xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
											},
											success: function(result) {
												var dom = document.getElementById("container");
												var myChart = echarts.init(dom);
												var app = {};
												option = null;
												var xAxisData = result["category"];
												var data1 = result["data"];
												//									for(var i = 0; i < 20; i++) {
												//										xAxisData.push('类目' + i);
												//										data1.push((Math.sin(i / 5) * (i / 5 - 10) + i / 6) * 5);
												//									}

												option = {
													title: {
														text: ''
													},
													legend: {
														data: [],
														align: 'left'
													},
													toolbox: {
														// y: 'bottom',
														feature: {
															magicType: {
																type: ['stack', 'tiled']
															},
															dataView: {},
															saveAsImage: {
																pixelRatio: 2
															}
														}
													},
													tooltip: {},
													xAxis: {
														data: xAxisData,
														silent: false,
														splitLine: {
															show: false
														}
													},
													yAxis: {},
													series: [{
														name: '总操作数',
														type: 'bar',
														data: data1,
														animationDelay: function(idx) {
															return idx * 10;
														}
													}],
													animationEasing: 'elasticOut',
													animationDelayUpdate: function(idx) {
														return idx * 5;
													},
													color: ['rgb(60,157,208)']
													
												};;
												if(option && typeof option === "object") {
													myChart.setOption(option, true);
												}

											},
											error: function(result, status) {
												console.log(result)
											},
											statusCode: {
												401: function() {
													alert("登录状态错误，请重新登录后再尝试");
													window.open('login.html?type=1');
												},
												405: function() {
													alert("您无权进行此操作");
													window.open('login.html?type=1');
												}
											}
										});
									})
								</script>
							</div>
						</div>
					</div>
					<div class="col-md-5">
						<div class="card mb-1">
							<div class="card-header">
								<i class="fa fa-adjust"></i>
								<a class="card-link" style='color:black'>运行状况</a>

							</div>
							<div class="card-body " style="height: 400px;">
								<div id="container1" style="height: 100%; -webkit-tap-highlight-color: transparent; user-select: none; position: relative;" _echarts_instance_="ec_1533636169715">
									<div style="position: relative; overflow: hidden; width: 800px; height: 931px; padding: 0px; margin: 0px; border-width: 0px; cursor: default;"><canvas data-zr-dom-id="zr_0" width="1600" height="1862" style="position: absolute; left: 0px; top: 0px; width: 800px; height: 931px; user-select: none; -webkit-tap-highlight-color: rgba(0, 0, 0, 0); padding: 0px; margin: 0px; border-width: 0px;"></canvas></div>
									<div style="position: absolute; display: none; border-style: solid; white-space: nowrap; z-index: 9999999; transition: left 0.4s cubic-bezier(0.23, 1, 0.32, 1), top 0.4s cubic-bezier(0.23, 1, 0.32, 1); background-color: rgba(50, 50, 50, 0.7); border-width: 0px; border-color: rgb(51, 51, 51); border-radius: 4px; color: rgb(255, 255, 255); font: 14px/21px sans-serif; padding: 5px; left: 485px; top: 415px;">印度<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#c23531;"></span>2011年: 104,970<br><span style="display:inline-block;margin-right:5px;border-radius:10px;width:10px;height:10px;background-color:#2f4554;"></span>2012年: 121,594</div>
								</div>
								<script type="text/javascript" src="js/echart/echarts.min.js"></script>
								<script type="text/javascript" src="js/echart/echarts-gl.min.js"></script>
								<script type="text/javascript" src="js/echart/ecStat.min.js"></script>
								<script type="text/javascript" src="js/echart/dataTool.min.js"></script>
								<script type="text/javascript" src="js/echart/china.js"></script>
								<script type="text/javascript" src="js/echart/world.js"></script>
								<script type="text/javascript" src="js/echart/api"></script>
								<script type="text/javascript" src="js/echart/getscript"></script>
								<script type="text/javascript" src="js/echart/bmap.min.js"></script>
								<script type="text/javascript" src="js/echart/simplex.js"></script>

								<script type="text/javascript">
									$(document).ready(function() {

										$.ajax({
											type: "post",
											url: getTopPersonListUrl,
											cache: false, //禁用缓存
											contentType: "application/json,charset=utf-8",
											data: null, //传入组装的参数
											dataType: "json",
											//										async: false,
											crossDomain: true,
											scriptCharset: 'utf-8',
											beforeSend: function(xhr) {
												xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
											},
											success: function(result) {
												var dom = document.getElementById("container2");
												var myChart = echarts.init(dom);
												var app = {};
												//											option = null;
												app.title = '近一周操作数';

												option = {

													tooltip: {
														trigger: 'axis',
														axisPointer: {
															type: 'shadow'
														}
													},
													legend: {
														data: []
													},
													grid: {
														left: '3%',
														right: '4%',
														bottom: '3%',
														containLabel: true
													},
													xAxis: {
														type: 'value',
														boundaryGap: [0, 0.01]
													},
													yAxis: {
														type: 'category',
														data: result["category"]
													},
													series: [{
														name: '近一周操作数',
														type: 'bar',
														data: result["data"]
													}],
													color: ['rgb(205,149,12)']

												};;
												if(option && typeof option === "object") {
													myChart.setOption(option, true);
												}

											},
											error: function(result, status) {
												console.log(result)
											},
											statusCode: {
												401: function() {
													alert("登录状态错误，请重新登录后再尝试");
													window.open('login.html?type=1');
												},
												405: function() {
													alert("您无权进行此操作");
													window.open('login.html?type=1');
												}
											}
										});
									})
								</script>
								<script type="text/javascript">
									$(document).ready(function() {

										$.ajax({
											type: "post",
											url: getExpSumUrl,
											cache: false, //禁用缓存
											contentType: "application/json,charset=utf-8",
											data: null, //传入组装的参数
											dataType: "json",
											//										async: false,
											crossDomain: true,
											scriptCharset: 'utf-8',
											beforeSend: function(xhr) {
												xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
											},
											success: function(result) {
												var dom = document.getElementById("container1");
												var myChart = echarts.init(dom);
												var app = {};
												option = null;
												option = {
													title: {
														text: '近一周程序执行情况',
														subtext: '后台系统错误记录',
														x: 'center'
													},
													tooltip: {
														trigger: 'item',
														formatter: "{a} <br/>{b} : {c} ({d}%)"
													},
													legend: {
														orient: 'vertical',
														left: 'left',
														data: ['正常', '错误']
													},
													series: [{
														name: '',
														type: 'pie',
														radius: '55%',
														center: ['50%', '60%'],
														data: [{
																value: result["sum"],
																name: '正常'
															},
															{
																value: result["exSum"],
																name: '错误'
															}
														],
														itemStyle: {
															emphasis: {
																shadowBlur: 10,
																shadowOffsetX: 0,
																shadowColor: 'rgba(0, 0, 0, 0.5)'
															}
														}
													}]
												};;
												if(option && typeof option === "object") {
													myChart.setOption(option, true);
												}

											},
											error: function(result, status) {
												console.log(result)
											},
											statusCode: {
												401: function() {
													alert("登录状态错误，请重新登录后再尝试");
													window.open('login.html?type=1');
												},
												405: function() {
													alert("您无权进行此操作");
													window.open('login.html?type=1');
												}
											}
										});
									})
								</script>
							</div>
						</div>
					</div>
				</div>

				</br>
				<div class="card mb-3">
					<div class="card-header">
						<i class="fa fa-filter"></i>
								<a class="card-link" style='color:black'>日活跃度</a>

					</div>
					<div class="card-body" style="height: 400px;">
						<div id="container" style="height: 100%"></div>
					</div>
					
				</div>

			</div>
			<!-- /.container-fluid-->
			<!-- /.content-wrapper-->
			<footer class="sticky-footer">
				<div class="container">
					<div class="text-center">
						<small>Copyright © Your Website 2018</small>
					</div>
				</div>
			</footer>

			<!-- Bootstrap core JavaScript-->
			<script src="vendor/jquery/jquery.min.js"></script>
			<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
			<!-- Core plugin JavaScript-->
			<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
			<!-- Page level plugin JavaScript-->
			<!--<script src="vendor/chart.js/Chart.min.js"></script>-->
			<script src="vendor/datatables/jquery.dataTables.js"></script>
			<script src="vendor/datatables/dataTables.bootstrap4.js"></script>
			<!-- Custom scripts for all pages-->
			<script src="js/sb-admin.min.js"></script>
			<!-- Custom scripts for this page-->
			<script src="js/sb-admin-datatables.min.js"></script>
			<!--<script src="js/sb-admin-charts.min.js"></script>-->
			<script src="js/jsxm.js"></script>
			<script>
				function logout() {

			$.ajax({
				type: "post",
				url: logoutUrl,
				cache: false, //禁用缓存
				data: "", //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					//								alert("登录状态错误，请重新登录");
					//							
					window.open('login.html');
				},
				error: function(result, status) {
					console.log(result)
					window.location.href = 'login.html';
				}
			});
		}

		function getNotice() {
			$.ajax({
				type: "post",
				url: getNoticeUrl,
				cache: false, //禁用缓存
				contentType: "application/json,charset=utf-8",
				data: null, //传入组装的参数
				dataType: "json",
				async: false,
				crossDomain: true,
				scriptCharset: 'utf-8',
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					var NotiData = "";
					for(i in result) {
						console.log(i);
						NotiData += '<div class="dropdown-divider"></div>' +
							'<a class="dropdown-item">' +
							'<span class="text-success">' +
							'<strong>' + result[i]["NoTitle"] + '</strong></span>' +
							'<span class="small float-right text-muted" >' + result[i]["NoTime"] + '</span>' +
							'</br><div class="dropdown-message small" >' + result[i]["NoContent"] + '</div></a>';

					}
					console.log(NotiData);
					$('#notice').append(NotiData);

				},
				error: function(result, status) {
					console.log(result)
				},
				statusCode: {
					401: function() {
						alert("登录状态错误，请重新登录后再尝试");
						window.open('login.html?type=1');
					},
					405: function() {
						alert("您无权进行此操作");
					}
				}
			});
		}
		</script>
			<script>
				$('#usernameLable').text(localStorage.getItem("username"));
			</script>
			<script>
				$(document).ready(function() {
					getNotice();
				})
			</script>

		</div>
	</body>

</html>