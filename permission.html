<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
		<meta name="description" content="">
		<meta name="author" content="">
		<title>权限管理</title>
		<!-- Bootstrap core CSS-->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom fonts for this template-->
		<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<!-- Page level plugin CSS-->
		<link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
		<!-- Custom styles for this template-->
		<link href="css/sb-admin.css" rel="stylesheet">
		<!-- Bootstrap core JavaScript-->
		<script src="vendor/jquery/jquery.min.js"></script>
		<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
		<!-- Core plugin JavaScript-->
		<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
		<!-- Page level plugin JavaScript-->
		<script src="vendor/chart.js/Chart.min.js"></script>
		<script src="vendor/datatables/jquery.dataTables.js"></script>
		<script src="vendor/datatables/dataTables.bootstrap4.js"></script>
		<!-- Custom scripts for all pages-->
		<script src="js/sb-admin.min.js"></script>
		<!-- Custom scripts for this page-->
		<script src="js/sb-admin-datatables.min.js"></script>
		<script src="js/jsxm.js"></script>

		<style>
			.form-check {
				cursor: pointer;
				color: #000;
				display: inline-block;
				height: 100px;
				width: 100px;
				line-height: 48px;
				font-size: 1.5em;
			}
			
			.checkbox span {
				display: inline-block;
				height: 25px;
				line-height: 18px;
				padding-left: 45px;
			}
		</style>

	</head>

	<body class="fixed-nav sticky-footer bg-dark" id="page-top">
		<!-- Navigation-->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
			<a class="navbar-brand" href="index.html">金审项目后台管理</a>
			<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav navbar-sidenav" id="exampleAccordion">

					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="userManagement.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">用户管理</span>
						</a>

					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="permission.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">权限管理</span>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav sidenav-toggler">
					<li class="nav-item">
						<a class="nav-link text-center" id="sidenavToggler">
							<i class="fa fa-fw fa-angle-left"></i>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav ml-auto">

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-bell"></i> 通知

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" style="width: 250px;" aria-labelledby="alertsDropdown" id="notice">
							<h6 class="dropdown-header">最近通知:</h6>

						</div>
					</li>

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-user"></i><label id="usernameLable">用户名</label>

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">

							<a class="dropdown-item" data-toggle="modal" data-target="#exampleModal" style="color:black">
								<i class="fa fa-fw fa-cogs"></i>个人信息
							</a>

							<div class="dropdown-divider"></div>
							<a class="dropdown-item" data-toggle="modal" data-target="#exampleModal" style="color:black" onclick="logout()">
								<i class="fa fa-fw fa-sign-out"></i>退出登录
							</a>

						</div>
					</li>

				</ul>
			</div>
		</nav>
		<!-- Logout Modal-->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
						<button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
					</div>
					<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
						<a class="btn btn-primary" href="login.html">Logout</a>
					</div>
				</div>
			</div>
		</div>
		<div class="content-wrapper">
			<div class="container-fluid">
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="#">项目管理</a>
					</li>
					<li class="breadcrumb-item active">权限管理</li>
				</ol>
				<!--<hr />
				<hr />-->
				<style>
					#roleHead {
						display: inline-block;
						vertical-align: middle;
					}
				</style>
				<div class="card mb-1" id="chooseCard">
					<div class="card-header mycardheader">
						<!--<i class="fa fa-filter"></i>-->
						<!--<a class="card-link" href="#collapseOne" data-toggle="collapse" style='color:black'>-->

						<div class="form-inline">
							<!--<div class="col-md-2">-->
							<div class="input-group">
								<span class="input-group-addon " id="roleHead">选择角色: &nbsp;</span>
								<select class="form-control" name="role" id="role" onchange="getPermissionDetail()">
									<option value="1">管理员</option>
									<option value="2">负责人</option>
									<option value="3">决策领导</option>
									<option value="4">大领导</option>
								</select>
							</div>
							<!--</div>-->
						</div>
						<!--</a>-->
					</div>

					<div class="card-body " id="permission" data-parent="#chooseCard">
						<table width="100%" border="0" class="table table-striped">
							<tr>
								<td>项目:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getProjectList">项目列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getProjectDetail">项目详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addProject">添加项目</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateProjectDetail">更新项目</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteProject">删除项目</label></td>
							</tr>
							<tr>
								<td>合同:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getContractList">合同列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getContractDetail">合同详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addContract">添加合同</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateContractDetail">更新合同</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteContract">删除合同</label></td>
							</tr>
							<tr>
								<td>财务:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getFinanceList">财务列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getFinanceDetail">财务详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addFinance">添加财务</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateFinance">更新财务</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteFinance">删除财务</label></td>
							</tr>
							<tr>
								<td>资产:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getAssetList">资产列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getAssetDetail">资产详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addAsset">添加资产</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateAssetDetail">更新资产</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteAsset">删除资产</label></td>
							</tr>
							<tr>
								<td>预算:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getBudgetListUrl">预算列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getBudgetDetail">预算详情</label></td>
								<td><label class="checkbox inline font-size"></label></td>
								<td><label class="checkbox inline font-size"></label></td>
								<td><label class="checkbox inline font-size"></label></td>

							</tr>
							<tr>
								<td>档案:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getDocList">档案列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getDocumentDetail">档案详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateDocumentDetail">更新档案</label></td>
								<td><label class="checkbox inline font-size"></label></td>
								<td><label class="checkbox inline font-size"></label></td>
							</tr>
							<tr>
								<td>用户:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getUserList">用户列表</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/initUserUpdate">用户详情</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addUser">添加用户</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateUser">更新用户</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteUser">删除用户</label></td>
							</tr>
							<tr>
								<td>其他:</td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/getNotification">查看通知</label></td>
								<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updatePermission">更改权限</label></td>
								<!--<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/addUser">添加用户</label></td>
						<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/updateUser">更新用户</label></td>
						<td><label class="checkbox inline font-size"><input type="checkbox" name="ckb" value="/deleteUser">删除用户</label></td>-->
							</tr>
						</table>
						<center><br />
							<button type="button" class="btn btn-dark col-md-3" onclick="updateLevel()">确定</button>
						</center>
					</div>
				</div>

			</div>
		</div>
		<footer class="sticky-footer">
			<div class="container">
				<div class="text-center">
					<small>Copyright © Your Website 2018</small>
				</div>
			</div>
		</footer>
		<!--更新成功-->
		<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">修改成功</h4>

					</div>
					<!--<div class="modal-body"></div>-->
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>

					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>
	</body>
	<!-- Bootstrap core JavaScript-->

	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
	<!-- Page level plugin JavaScript-->
	<!--<script src="vendor/chart.js/Chart.min.js"></script>-->
	<script src="vendor/datatables/jquery.dataTables.js"></script>
	<script src="vendor/datatables/dataTables.bootstrap4.js"></script>
	<!-- Custom scripts for all pages-->
	<script src="js/sb-admin.min.js"></script>
	<!-- Custom scripts for this page-->
	<script src="js/sb-admin-datatables.min.js"></script>
	<script type="text/javascript">
		function logout() {

			$.ajax({
				type: "post",
				url: logoutUrl,
				cache: false, //禁用缓存
				data: "", //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					//								alert("登录状态错误，请重新登录");
					//							
					window.open('login.html');
				},
				error: function(result, status) {
					console.log(result)
					window.location.href = 'login.html';
				}
			});
		}

		function getNotice() {
			$.ajax({
				type: "post",
				url: getNoticeUrl,
				cache: false, //禁用缓存
				contentType: "application/json,charset=utf-8",
				data: null, //传入组装的参数
				dataType: "json",
				async: false,
				crossDomain: true,
				scriptCharset: 'utf-8',
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					var NotiData = "";
					for(i in result) {
						console.log(i);
						NotiData += '<div class="dropdown-divider"></div>' +
							'<a class="dropdown-item">' +
							'<span class="text-success">' +
							'<strong>' + result[i]["NoTitle"] + '</strong></span>' +
							'<span class="small float-right text-muted" >' + result[i]["NoTime"] + '</span>' +
							'</br><div class="dropdown-message small" >' + result[i]["NoContent"] + '</div></a>';

					}
					console.log(NotiData);
					$('#notice').append(NotiData);

				},
				error: function(result, status) {
					console.log(result)
				},
				statusCode: {
					401: function() {
						alert("登录状态错误，请重新登录后再尝试");
						window.open('login.html?type=1');
					}
				}
			});
		}

		function updateLevel() {
			var param = {};
			var permission = {};
			var permissions = [];
			$("input[name='ckb']:checked	").each(function(i) {
				permission = {};
				permission["url"] = $(this).val();
				permission["level"] = $('#role').val();
				permission["name"] = $(this).parent().text();
				permissions[i] = permission;
			});

			param.level = $('#role').val();
			param.permissions = permissions;

			$.ajax({
				type: "post",
				url: updatePermissionUrl,
				cache: false, //禁用缓存
				contentType: "application/json",
				data: JSON.stringify(param), //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {

					//						$('#closeModel').click();
					$('#successModal').modal('show');

				},
				error: function(result, status) {
					console.log(result)
				},
				statusCode: {
					401: function() {
						alert("登录状态错误，请重新登录后再尝试");
						window.open('login.html?type=1');
					}
				}
			});
		}
		//		$('#role').change(getPermissionDetail());
		$(document).ready(getPermissionDetail());

		function getPermissionDetail() {
			var param = {};
			param.level = $('#role').val();
			$("#permission").find("input[type='checkbox']").each(function() {
				$(this).removeAttr("checked")
			})
			$.ajax({
				type: "post",
				url: getPermissionDetailUrl,
				cache: false, //禁用缓存
				//					contentType: "application/json",
				//					data: JSON.stringify(param), //传入组装的参数
				data: param,
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					$.each(result, function(index, value) {
						$("#permission").find("input[type='checkbox']").each(function() {
							if(value.url == $(this).val()) {
								$(this).attr("checked", "checked");
							}
						});
					})
				}

			});
		}
	</script>
	<script>
		$(document).ready(function() {
			getNotice();

		})
	</script>

	<script>
		$('#usernameLable').text(localStorage.getItem("username"));
	</script>

</html>