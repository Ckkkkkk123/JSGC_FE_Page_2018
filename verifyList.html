<!DOCTYPE html>
<html lang="en">

	<head>
		<meta charset="utf-8">
		<title>合同管理</title>
		<!-- Bootstrap core CSS-->
		<link href="vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
		<!-- Custom fonts for this template-->
		<link href="vendor/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
		<!-- Page level plugin CSS-->
		<link href="vendor/datatables/dataTables.bootstrap4.css" rel="stylesheet">
		<!-- Custom styles for this template-->
		<link href="css/sb-admin.css" rel="stylesheet">
		<link rel="stylesheet" href="laydate/theme/default/laydate.css">
		<link rel="stylesheet" href="css/chosen.min.css">
		<link rel="stylesheet" href="css/fileinput/fileinput.min.css" />
		<script src="laydate/laydate.js" charset="utf-8"></script>
		<script src="js/jsxm.js"></script>

		<style>
			.mycardheader {
				padding: 0;
			}
		</style>

	</head>

	<body class="fixed-nav sticky-footer bg-dark" id="page-top">
		<!-- Navigation-->
		<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top" id="mainNav">
			<a id="userLevelText" class="navbar-brand" href="index.html">金审项目管理</a>
			<button class="navbar-toggler navbar-toggler-right" type="button" data-toggle="collapse" data-target="#navbarResponsive" aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>
			<div class="collapse navbar-collapse" id="navbarResponsive">
				<ul class="navbar-nav navbar-sidenav" id="exampleAccordion">
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Components">
						<a class="nav-link nav-link-collapse collapsed" data-toggle="collapse" href="#collapseComponents" data-parent="#exampleAccordion">
							<i class="fa fa-fw fa-wrench"></i>
							<span class="nav-link-text">项目管理</span>
						</a>
						<ul class="sidenav-second-level collapse" id="collapseComponents">
							<li>
								<a href="project.html">项目列表</a>
							</li>
							<li>
								<a href="contract.html">合同列表</a>
							</li>
						</ul>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="financeList.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">财务管理</span>
						</a>

					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="budget.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">预算查看</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="asset.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">资产管理</span>
						</a>
					</li>
					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Tables">
						<a class="nav-link" href="document.html">
							<i class="fa fa-fw fa-table"></i>
							<span class="nav-link-text">档案管理</span>
						</a>
					</li>

					<li class="nav-item" data-toggle="tooltip" data-placement="right" title="Link">
						<a class="nav-link" href="#">
							<i class="fa fa-fw fa-link"></i>
							<span class="nav-link-text">审核</span>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav sidenav-toggler">
					<li class="nav-item">
						<a class="nav-link text-center" id="sidenavToggler">
							<i class="fa fa-fw fa-angle-left"></i>
						</a>
					</li>
				</ul>
				<ul class="navbar-nav ml-auto">
					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-bell"></i> 通知

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" style="width: 250px;" aria-labelledby="alertsDropdown" id="notice">
							<h6 class="dropdown-header">最近通知:</h6>
						</div>
					</li>

					<li class="nav-item dropdown">
						<a class="nav-link dropdown-toggle mr-lg-2" id="alertsDropdown" href="#" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
							<i class="fa fa-fw fa-user"></i><label id="usernameLable">用户名</label>

						</a>
						<!--拉到左边dropdown-menu-right-->
						<div class="dropdown-menu dropdown-menu-right" aria-labelledby="alertsDropdown">

							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="window.open('userInfo.html')">
								<i class="fa fa-fw fa-cogs"></i>个人信息
							</a>

							<div class="dropdown-divider"></div>
							<a class="dropdown-item" data-toggle="modal" style="color:black" onclick="logout()">
								<i class="fa fa-fw fa-sign-out"></i>退出登录
							</a>

						</div>
					</li>

				</ul>
			</div>
		</nav>
		<div class="content-wrapper">
			<div class="container-fluid">
				<!-- Breadcrumbs-->
				<ol class="breadcrumb">
					<li class="breadcrumb-item">
						<a href="#">审核</a>
					</li>
					<li class="breadcrumb-item active">预算审核</li>
				</ol>
				<!-- Example DataTables Card-->
				<div class="card mb-3">
					<div class="card-header">
						<i class="fa fa-filter"></i>
						<a class="card-link" style='color:black'>待审核列表</a>

					</div>
					<div class="card-body" style="height: 650px;">
						<table class="table table-hover  table-bordered">
							<thead>
								<tr>
									<th>项目</th>
									<th>申请的预算</th>
									<th>申请附言</th>
									<th>操作</th>
								</tr>
							</thead>
							<tbody id="tbody">
							</tbody>
						</table>
						<span id="nonInfo"></span>

					</div>

				</div>

			</div>
		</div>
		<!-- /.container-fluid-->
		<!-- /.content-wrapper-->
		<footer class="sticky-footer">
			<div class="container">
				<div class="text-center">
					<small>Copyright © Your Website 2018</small>
				</div>
			</div>
		</footer>
		<!-- Scroll to Top Button-->
		<a class="scroll-to-top rounded" href="#page-top">
			<i class="fa fa-angle-up"></i>
		</a>
		<!-- Logout Modal-->
		<div class="modal fade" id="exampleModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
			<div class="modal-dialog" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="exampleModalLabel">Ready to Leave?</h5>
						<button class="close" type="button" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">×</span>
            </button>
					</div>
					<div class="modal-body">Select "Logout" below if you are ready to end your current session.</div>
					<div class="modal-footer">
						<button class="btn btn-secondary" type="button" data-dismiss="modal">Cancel</button>
						<a class="btn btn-primary" href="login.html">Logout</a>
					</div>
				</div>
			</div>
		</div>

		<!--修改成功-->
		<div class="modal fade" id="successModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title">修改成功</h4>

						<!--<button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>-->

					</div>
					<!--<div class="modal-body"></div>-->
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">关闭</button>
						<!--<button type="button" class="btn btn-primary">提交更改</button>-->
					</div>
				</div>
				<!-- /.modal-content -->
			</div>
			<!-- /.modal -->
		</div>

	</body>
	<!-- Bootstrap core JavaScript-->
	<script src="vendor/jquery/jquery.min.js"></script>
	<script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
	<!-- Core plugin JavaScript-->
	<script src="vendor/jquery-easing/jquery.easing.min.js"></script>
	<!-- Page level plugin JavaScript-->
	<script src="vendor/datatables/jquery.dataTables.js"></script>
	<script src="vendor/datatables/dataTables.bootstrap4.js"></script>
	<!-- Custom scripts for all pages-->
	<script src="js/sb-admin.min.js"></script>
	<!-- Custom scripts for this page-->
	<script src="js/sb-admin-datatables.min.js"></script>
	<script src="js/chosen.jquery.min.js"></script>
	<script src="js/fileinput/fileinput.min.js"></script>
	<script type="text/javascript">
		$(function() {
			var userLevel = localStorage.getItem('level');
			switch(userLevel) {
				case '1':
					$('.3button').show();
					$('#userLevelText').append('&nbsp;&nbsp;(管理员)');
					break;
				case '2':
					$('.3button').show();
					$('#userLevelText').append('&nbsp;&nbsp;(项目负责人)');
					break;
				case '3':
					$('#userLevelText').append('&nbsp;&nbsp;(决策领导)');
					break;
				case '4':
					$('#userLevelText').append('&nbsp;&nbsp;(大领导)');
					break;
				default:
					alert('不存在角色');
			}

		});
	</script>
	<script>
		//发送修改的内容
		function getVerifyList() {
			//				ajax
			var param = {};

			$.ajax({
				type: "post",
				url: getVerifyListUrl,
				cache: false, //禁用缓存
				contentType: "application/json",
				data: JSON.stringify(param), //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					var resultHtml = '';
					for(var item in result) {
						resultHtml += '<tr>';
						resultHtml += '<td>' + result[item]["projectName"] + '</td>';
						resultHtml += '<td>' + result[item]["applyMoney"] + '</td>';
						resultHtml += '<td>' + result[item]["applyReason"] + '</td>';
						resultHtml += '<td><button class="btn btn-danger" onclick="delVerify(' + result[item]["verifyID"] + ')">拒绝</button>&nbsp;&nbsp;&nbsp;&nbsp;<button class="btn btn-warning" onclick="passVerify(' + result[item]["verifyID"] + ')" >同意</button></td>';
						resultHtml += '</tr>';

					}
					if(resultHtml==""){
						$("#nonInfo").html("没有待审核项目")
					}
					$("#tbody").html(resultHtml);
					
					console.log(result[item]);

				},
				error: function(result, status) {
					var resultHtml = '<tr>没有待审核项目</tr>';
					$("#tbody").html(resultHtml);
				},
				statusCode: {
					401: function() {
						alert("登录状态错误，请重新登录后再尝试");
						window.open('login.html?type=1');
					},
					405: function() {
						alert("您无权进行此操作");
					}
				}
			});
		}

		function delVerify(verifyID) {
			param = {}
			param["verifyID"]=verifyID;
			$.ajax({
				type: "post",
				url: delVerifyUrl,
				cache: false, //禁用缓存
				data: param, //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					$('#successModal').modal('show');
					getVerifyList()
				},
				error: function(result, status) {}
			});
		}
		
		function passVerify(verifyID) {
			param = {}
			param["verifyID"]=verifyID;
			$.ajax({
				type: "post",
				url: passVerifyUrl,
				cache: false, //禁用缓存
				data: param, //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					$('#successModal').modal('show');
					getVerifyList()
				},
				error: function(result, status) {}
			});
		}

		function logout() {

			$.ajax({
				type: "post",
				url: logoutUrl,
				cache: false, //禁用缓存
				data: "", //传入组装的参数
				dataType: "json",
				async: false,
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					//								alert("登录状态错误，请重新登录");
					//							
					window.open('login.html');
				},
				error: function(result, status) {
					console.log(result)
					window.location.href = 'login.html';
				}
			});
		}

		function getNotice() {
			$.ajax({
				type: "post",
				url: getNoticeUrl,
				cache: false, //禁用缓存
				contentType: "application/json,charset=utf-8",
				data: null, //传入组装的参数
				dataType: "json",
				async: false,
				crossDomain: true,
				scriptCharset: 'utf-8',
				beforeSend: function(xhr) {
					xhr.setRequestHeader("Authorization", localStorage.getItem("Token"));
				},
				success: function(result) {
					var NotiData = "";
					for(i in result) {
						console.log(i);
						NotiData += '<div class="dropdown-divider"></div>' +
							'<a class="dropdown-item">' +
							'<span class="text-success">' +
							'<strong>' + result[i]["NoTitle"] + '</strong></span>' +
							'<span class="small float-right text-muted" >' + result[i]["NoTime"] + '</span>' +
							'</br><div class="dropdown-message small" >' + result[i]["NoContent"] + '</div></a>';

					}
					console.log(NotiData);
					$('#notice').append(NotiData);

				},
				error: function(result, status) {
					console.log(result)
				},
				statusCode: {
					401: function() {
						alert("登录状态错误，请重新登录后再尝试");
						window.open('login.html?type=1');
					},
					405: function() {
						alert("您无权进行此操作");
					}
				}
			});
		}
	</script>
	<script>
		$('#usernameLable').text(localStorage.getItem("username"));
	</script>
	<script>
		$(document).ready(function() {
			getNotice();
			getVerifyList();
		})
	</script>